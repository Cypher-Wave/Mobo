<%- include("partials/head.ejs") %>
<body id="home">
<div class="container">
    <%- include("partials/sideMenu.ejs") %>
    <main>
        <h1 class="txt">Dashboard</h1>
        <!-- Grafico -->
        <div class="graficos">
            <div>
                <h3 class="txtGrafic">Qualidade de Colheita</h3>
                <canvas id="myChart"></canvas>
            </div>   
            <div>
                <h3 class="txtGrafic">Colheita da Semana</h3>
                <canvas id="myChart2"></canvas>
            </div>
            <div>
                <h3 class="txtGrafic">Tendencia Crescimento da Plantação </h3>
                <canvas id="myChart3"></canvas>
            </div>
            <div>
                <h3 class="txtGrafic">Total Colhido</h3>
                <canvas id="myChart4"></canvas>
            </div>
        </div>
        <!-- Area relatorios  -->          
        <main class="new-users">
            <h2 class="txt2">Relatórios</h2>
            <!-- Botão Ver Mais -->
            <div class="button-container">
                <a href="/reports"><button class="view-more-btn">Ver Mais</button></a>
            </div>
            <div class="user-list">
                <!-- Cabeçalho da Tabela -->
                <div class="table-header">
                    <div class="table-cell">Índice</div>
                    <div class="table-cell">Data Colheita</div>
                    <div class="table-cell">Hora Início</div>
                    <div class="table-cell">Hora Término</div>
                    <div class="table-cell">Duração</div>
                    <div class="table-cell">Quantidade Colhida</div>
                    <div class="table-cell">Plantação</div>
                    <div class="table-cell">Qualidade</div>
                </div>
                <!-- Linha da Tabela -->
                <% harvests.forEach((harvest, i) => { %>
                <div class="table-row">
                    <div class="table-cell"><%= i+1 %></div>
                    <div class="table-cell"><%= new Date(harvest.harvestDate).toLocaleDateString("pt-BR") %></div>
                    <div class="table-cell"><%= harvest.harvestStart %></div>
                    <div class="table-cell"><%= harvest.harvestEnd %></div>
                    <div class="table-cell"><%= harvest.harvestDuration %></div>
                    <div class="table-cell"><%= harvest.harvestedQuantity %></div>
                    <div class="table-cell"><%= harvest.planting.plantingName %></div>
                    <div class="table-cell"><%= harvest.quality %>/10</div>
                </div>
                <% }) %>                   
            </div>
        </main>
    </main>
    <!--  Botao darkMode -->
    <div class="right-section">
        <div class="nav">
            <button id="menu-btn">
                <span class="material-icons-sharp">menu</span>
            </button>
            <div class="dark-mode">
                <span class="material-icons-sharp active"></span>
                <span class="material-icons-sharp"></span>
            </div>
            <div class="perfilFT">
                <a href="/profile" class="profile-link">
                    <img class="profile-img" src="<%= user.userImage ? ('/uploads/img/users/' + user.userImage) : '/assets/img/icon/perfil.png' %>">
                    <div class="profile-info">
                        <p class="txts"><strong>Nome:</strong> <%= user.userName %></p>
                        <p class="txts"><strong>Email:</strong> <%= user.userEmail %></p>
                        <p class="txt1Card">Logout</p>
                    </div>
                </a>
            </div>
        </div>
        <!-- Ícone de notificação -->
        <div class="notificacao-container">
            <img src="/assets/img/icon/notificacao.png" alt="Ícone de Notificação" class="notificacao-icone" id="notificacao-icone">
            <span class="badge" id="notificacao-badge">3</span>
        </div>
        <!-- Caixa de notificação -->
        <div class="caixa-notificacao" id="caixa-notificacao">
            <h3>Notificações</h3>
            <ul id="lista-notificacoes">
                <li class="notificacao-item alerta">
                    <p>Atenção chuvas fortes se aproximam, proteja sua Plantação!</p>
                    <button onclick="excluirNotificacao(this)">Excluir</button>
                    <button onclick="gerarAlerta('Nova atualização de sistema disponível!')">Gerar Alerta</button>
                </li>
                <li class="notificacao-item">
                    <p>Alta Temperatura.</p>
                    <button onclick="excluirNotificacao(this)">Excluir</button>
                    <button onclick="gerarAlerta('Seu pedido foi enviado.')">Gerar Alerta</button>
                </li>
                <li class="notificacao-item">
                    <p>Baixa Umidade.</p>
                    <button onclick="excluirNotificacao(this)">Excluir</button>
                    <button onclick="gerarAlerta('Você tem 3 novas mensagens.')">Gerar Alerta</button>
                </li>
            </ul>
            <button id="fechar-caixa" onclick="fecharCaixa()">Fechar</button>
        </div> 
    </div>
</div>

<script>
    const qualityLabels = <%- JSON.stringify(qualityByMonth.map(item => item.period)) %>;
    const qualityData = <%- JSON.stringify(qualityByMonth.map(item => item.averageQuality)) %>;

    const harvestWeekLabels = <%- JSON.stringify(harvestThisWeek.map(item => item.day)) %>; 
    const harvestWeekData = <%- JSON.stringify(harvestThisWeek.map(item => item.total)) %>;

    const trendLabels = <%- JSON.stringify(growthTrend.map(item => item.month)) %>;
    const trendData = <%- JSON.stringify(growthTrend.map(item => item.growth)) %>;

    const totalLabels = <%- JSON.stringify(Object.keys(totalHarvestByMonth || {})) %>;
    const totalData = <%- JSON.stringify(Object.values(totalHarvestByMonth || {})) %>;
</script>
<script src="/assets/js/graficosDash.js"></script>   
<script src="/assets/js/dashboard.js"></script>
<script src="/assets/js/notificacao.js"></script>     
</body>
</html>